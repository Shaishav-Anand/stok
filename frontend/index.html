<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>STOK — Agentic Inventory Manager</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@300;400;500&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet"/>
<style>
  :root {
    --bg: #0a0a0f; --surface: #111118; --surface2: #1a1a24; --border: #2a2a3a;
    --accent: #00ff88; --accent2: #ff6b35; --accent3: #7c6fff; --warn: #ffd166;
    --danger: #ff4757; --text: #e8e8f0; --muted: #6b6b88;
    --font-display: 'Syne', sans-serif; --font-mono: 'DM Mono', monospace;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { background:var(--bg); color:var(--text); font-family:var(--font-mono); font-size:13px; min-height:100vh; }
  body::before { content:''; position:fixed; inset:0; background-image:linear-gradient(rgba(0,255,136,0.015) 1px,transparent 1px),linear-gradient(90deg,rgba(0,255,136,0.015) 1px,transparent 1px); background-size:40px 40px; pointer-events:none; z-index:0; }

  /* AUTH */
  .auth-overlay { position:fixed; inset:0; background:var(--bg); display:flex; align-items:center; justify-content:center; z-index:9999; }
  .auth-box { width:360px; background:var(--surface); border:1px solid var(--border); border-radius:12px; padding:36px; }
  .auth-logo { font-family:var(--font-display); font-size:28px; font-weight:800; color:var(--accent); margin-bottom:8px; }
  .auth-sub { color:var(--muted); font-size:12px; margin-bottom:28px; }
  .form-group { margin-bottom:16px; }
  .form-label { font-size:11px; color:var(--muted); letter-spacing:1px; text-transform:uppercase; display:block; margin-bottom:6px; }
  .form-input { width:100%; background:var(--bg); border:1px solid var(--border); color:var(--text); padding:10px 14px; border-radius:6px; font-family:var(--font-mono); font-size:13px; transition:border-color 0.15s; }
  .form-input:focus { outline:none; border-color:var(--accent3); }
  .btn-full { width:100%; padding:12px; border-radius:6px; border:none; background:var(--accent); color:var(--bg); font-family:var(--font-display); font-size:14px; font-weight:700; cursor:pointer; transition:opacity 0.15s; }
  .btn-full:hover { opacity:0.85; }
  .auth-error { color:var(--danger); font-size:12px; margin-top:10px; display:none; }

  /* HEADER */
  header { position:sticky; top:0; z-index:100; background:rgba(10,10,15,0.92); backdrop-filter:blur(20px); border-bottom:1px solid var(--border); padding:0 32px; height:60px; display:flex; align-items:center; justify-content:space-between; }
  .logo { font-family:var(--font-display); font-size:22px; font-weight:800; color:var(--accent); display:flex; align-items:center; gap:10px; }
  .logo-dot { width:8px; height:8px; background:var(--accent); border-radius:50%; animation:pulse 2s infinite; }
  @keyframes pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:0.5;transform:scale(0.8)} }
  .tab-bar { display:flex; gap:4px; }
  .tab { padding:6px 16px; border-radius:4px; cursor:pointer; font-size:12px; color:var(--muted); border:1px solid transparent; background:none; transition:all 0.2s; font-family:var(--font-mono); }
  .tab:hover { color:var(--text); border-color:var(--border); }
  .tab.active { color:var(--accent); background:rgba(0,255,136,0.08); border-color:rgba(0,255,136,0.3); }
  .header-right { display:flex; align-items:center; gap:16px; }
  .agent-status { display:flex; align-items:center; gap:8px; font-size:11px; color:var(--accent); background:rgba(0,255,136,0.05); border:1px solid rgba(0,255,136,0.2); padding:6px 14px; border-radius:4px; }
  .status-dot { width:6px; height:6px; background:var(--accent); border-radius:50%; animation:pulse 1.5s infinite; }
  .user-badge { font-size:11px; color:var(--muted); }

  /* LAYOUT */
  .app { position:relative; z-index:1; max-width:1600px; margin:0 auto; padding:28px 32px; }
  .section { display:none; }
  .section.active { display:block; }

  /* STATS */
  .stats-row { display:grid; grid-template-columns:repeat(5,1fr); gap:16px; margin-bottom:28px; }
  .stat-card { background:var(--surface); border:1px solid var(--border); border-radius:8px; padding:20px; position:relative; overflow:hidden; }
  .stat-card::after { content:''; position:absolute; top:0; left:0; right:0; height:2px; }
  .stat-card.green::after{background:var(--accent)} .stat-card.orange::after{background:var(--accent2)} .stat-card.purple::after{background:var(--accent3)} .stat-card.yellow::after{background:var(--warn)} .stat-card.red::after{background:var(--danger)}
  .stat-label { font-size:10px; letter-spacing:1.5px; text-transform:uppercase; color:var(--muted); margin-bottom:10px; }
  .stat-value { font-family:var(--font-display); font-size:32px; font-weight:700; line-height:1; margin-bottom:6px; }
  .stat-sub { font-size:11px; color:var(--muted); }
  .stat-sub .hi { color:var(--accent); } .stat-sub .warn { color:var(--warn); } .stat-sub .danger { color:var(--danger); }

  /* SECTION HEADER */
  .section-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:20px; }
  .section-title { font-family:var(--font-display); font-size:18px; font-weight:700; display:flex; align-items:center; gap:10px; }
  .badge { font-family:var(--font-mono); font-size:11px; font-weight:400; background:rgba(255,107,53,0.15); color:var(--accent2); border:1px solid rgba(255,107,53,0.3); padding:3px 10px; border-radius:20px; }
  .badge.accent { background:rgba(0,255,136,0.1); color:var(--accent); border-color:rgba(0,255,136,0.3); }

  /* ACTIONS */
  .actions-grid { display:flex; flex-direction:column; gap:12px; }
  .action-card { background:var(--surface); border:1px solid var(--border); border-radius:8px; padding:20px 24px; display:grid; grid-template-columns:auto 1fr auto; gap:20px; align-items:center; animation:slideIn 0.3s ease both; }
  @keyframes slideIn { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:translateY(0)} }
  .action-card.urgent{border-left:3px solid var(--danger)} .action-card.high{border-left:3px solid var(--warn)} .action-card.normal{border-left:3px solid var(--accent3)}
  .action-card.approved{border-left:3px solid var(--accent);opacity:0.6} .action-card.rejected{border-left:3px solid var(--muted);opacity:0.35}
  .action-type-badge { padding:4px 10px; border-radius:4px; font-size:10px; letter-spacing:1px; text-transform:uppercase; white-space:nowrap; }
  .type-order{background:rgba(0,255,136,0.1);color:var(--accent);border:1px solid rgba(0,255,136,0.2)}
  .type-transfer{background:rgba(124,111,255,0.1);color:var(--accent3);border:1px solid rgba(124,111,255,0.2)}
  .type-price{background:rgba(255,209,102,0.1);color:var(--warn);border:1px solid rgba(255,209,102,0.2)}
  .type-return{background:rgba(255,107,53,0.1);color:var(--accent2);border:1px solid rgba(255,107,53,0.2)}
  .action-title { font-family:var(--font-display); font-size:15px; font-weight:600; margin-bottom:4px; }
  .action-meta { display:flex; gap:16px; font-size:11px; color:var(--muted); margin-bottom:8px; }
  .action-meta em { color:var(--text); font-style:normal; }
  .action-reasoning { font-size:11px; color:var(--muted); line-height:1.6; border-left:2px solid var(--border); padding-left:12px; margin-top:8px; }
  .confidence-bar { display:flex; align-items:center; gap:8px; font-size:11px; color:var(--muted); margin-top:8px; }
  .bar-track { flex:1; height:3px; background:var(--border); border-radius:2px; max-width:120px; }
  .bar-fill { height:100%; border-radius:2px; background:var(--accent); }
  .action-controls { display:flex; flex-direction:column; gap:8px; align-items:flex-end; min-width:200px; }
  .qty-modify { display:flex; align-items:center; gap:6px; font-size:11px; color:var(--muted); }
  .qty-input { width:70px; background:var(--bg); border:1px solid var(--border); color:var(--text); padding:5px 8px; border-radius:4px; font-family:var(--font-mono); font-size:12px; text-align:right; }
  .qty-input:focus { outline:none; border-color:var(--accent3); }
  .btn-row { display:flex; gap:6px; }
  .btn { padding:7px 16px; border-radius:4px; font-family:var(--font-mono); font-size:11px; cursor:pointer; border:1px solid transparent; transition:all 0.15s; }
  .btn-approve { background:rgba(0,255,136,0.12); color:var(--accent); border-color:rgba(0,255,136,0.3); }
  .btn-approve:hover { background:rgba(0,255,136,0.22); border-color:var(--accent); }
  .btn-reject { background:rgba(255,71,87,0.08); color:var(--danger); border-color:rgba(255,71,87,0.2); }
  .btn-reject:hover { background:rgba(255,71,87,0.15); }
  .btn-detail { background:rgba(124,111,255,0.08); color:var(--accent3); border-color:rgba(124,111,255,0.2); }
  .status-tag { font-size:11px; padding:4px 12px; border-radius:20px; }
  .tag-approved { background:rgba(0,255,136,0.1); color:var(--accent); }
  .tag-rejected { background:rgba(107,107,136,0.15); color:var(--muted); }

  /* INVENTORY TABLE */
  .table-wrap { background:var(--surface); border:1px solid var(--border); border-radius:8px; overflow:hidden; }
  table { width:100%; border-collapse:collapse; }
  thead tr { background:var(--surface2); border-bottom:1px solid var(--border); }
  th { padding:12px 16px; text-align:left; font-size:10px; letter-spacing:1.5px; text-transform:uppercase; color:var(--muted); }
  td { padding:14px 16px; border-bottom:1px solid rgba(42,42,58,0.5); font-size:12px; }
  tr:last-child td { border-bottom:none; }
  tr:hover td { background:rgba(124,111,255,0.03); }
  .risk-badge { display:inline-block; padding:3px 10px; border-radius:3px; font-size:10px; font-weight:500; }
  .risk-critical{background:rgba(255,71,87,0.15);color:var(--danger)} .risk-high{background:rgba(255,209,102,0.12);color:var(--warn)} .risk-medium{background:rgba(255,107,53,0.1);color:var(--accent2)} .risk-low{background:rgba(0,255,136,0.08);color:var(--accent)}
  .stock-bar-wrap { display:flex; align-items:center; gap:8px; }
  .stock-mini-bar { width:80px; height:4px; background:var(--border); border-radius:2px; overflow:hidden; }
  .stock-mini-fill { height:100%; border-radius:2px; }

  /* SUPPLIERS */
  .supplier-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:16px; }
  .supplier-card { background:var(--surface); border:1px solid var(--border); border-radius:8px; padding:20px; }
  .supplier-header { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:16px; }
  .supplier-name { font-family:var(--font-display); font-size:15px; font-weight:600; }
  .supplier-code { font-size:10px; color:var(--muted); margin-top:2px; }
  .supplier-rank { font-family:var(--font-display); font-size:22px; font-weight:800; color:var(--accent3); }
  .metric-row { display:flex; justify-content:space-between; padding:8px 0; border-bottom:1px solid var(--border); font-size:12px; }
  .metric-row:last-child { border:none; }
  .metric-label { color:var(--muted); }

  /* UPLOAD */
  .upload-grid { display:grid; grid-template-columns:1fr 1fr; gap:20px; }
  .upload-card { background:var(--surface); border:1px solid var(--border); border-radius:8px; padding:24px; }
  .upload-title { font-family:var(--font-display); font-size:15px; font-weight:600; margin-bottom:4px; }
  .upload-desc { font-size:11px; color:var(--muted); margin-bottom:16px; line-height:1.6; }
  .upload-cols { background:var(--bg); border:1px solid var(--border); border-radius:6px; padding:12px; margin-bottom:16px; font-size:11px; color:var(--muted); line-height:1.8; }
  .upload-cols strong { color:var(--accent3); }
  .file-drop { border:2px dashed var(--border); border-radius:6px; padding:24px; text-align:center; cursor:pointer; transition:all 0.2s; }
  .file-drop:hover,.file-drop.dragover { border-color:var(--accent3); background:rgba(124,111,255,0.05); }
  .file-drop input { display:none; }
  .file-drop-label { font-size:12px; color:var(--muted); }
  .file-drop-label strong { color:var(--accent3); cursor:pointer; }
  .upload-result { margin-top:12px; padding:12px; border-radius:6px; font-size:12px; line-height:1.6; display:none; }
  .upload-result.success { background:rgba(0,255,136,0.08); border:1px solid rgba(0,255,136,0.2); color:var(--accent); }
  .upload-result.error { background:rgba(255,71,87,0.08); border:1px solid rgba(255,71,87,0.2); color:var(--danger); }
  .btn-upload { width:100%; padding:10px; border-radius:6px; border:1px solid rgba(0,255,136,0.3); background:rgba(0,255,136,0.1); color:var(--accent); font-family:var(--font-mono); font-size:12px; cursor:pointer; transition:all 0.15s; }
  .btn-upload:hover { background:rgba(0,255,136,0.2); }
  .btn-upload:disabled { opacity:0.4; cursor:not-allowed; }

  /* AUDIT */
  .audit-list { background:var(--surface); border:1px solid var(--border); border-radius:8px; overflow:hidden; }
  .audit-item { display:grid; grid-template-columns:160px 130px 100px 1fr 140px; gap:12px; align-items:center; padding:12px 20px; border-bottom:1px solid rgba(42,42,58,0.4); font-size:12px; }
  .audit-item:last-child{border:none} .audit-item:hover{background:var(--surface2)}
  .audit-time{color:var(--muted);font-size:11px} .audit-user{color:var(--accent3)}
  .outcome-approved{color:var(--accent)} .outcome-rejected{color:var(--danger)} .outcome-modified{color:var(--warn)} .outcome-executed{color:var(--accent3)}

  /* TOAST */
  .toast-container { position:fixed; bottom:24px; right:24px; z-index:9999; display:flex; flex-direction:column; gap:10px; }
  .toast { background:var(--surface); border:1px solid var(--border); border-radius:8px; padding:14px 18px; font-size:12px; min-width:280px; animation:toastIn 0.3s ease; display:flex; align-items:center; gap:10px; }
  @keyframes toastIn { from{opacity:0;transform:translateX(20px)} to{opacity:1;transform:translateX(0)} }
  .toast.success{border-left:3px solid var(--accent)} .toast.error{border-left:3px solid var(--danger)} .toast.info{border-left:3px solid var(--accent3)}

  /* LOADING */
  .loading { text-align:center; padding:60px; color:var(--muted); font-size:12px; }
  .spinner { display:inline-block; width:20px; height:20px; border:2px solid var(--border); border-top-color:var(--accent); border-radius:50%; animation:spin 0.8s linear infinite; margin-bottom:12px; }
  @keyframes spin { to{transform:rotate(360deg)} }

  /* MODAL */
  .modal-overlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.7); z-index:1000; backdrop-filter:blur(4px); align-items:center; justify-content:center; }
  .modal-overlay.open{display:flex}
  .modal { background:var(--surface); border:1px solid var(--border); border-radius:12px; width:600px; max-height:80vh; overflow-y:auto; animation:modalIn 0.2s ease; }
  @keyframes modalIn{from{opacity:0;transform:scale(0.95)}to{opacity:1;transform:scale(1)}}
  .modal-header{padding:24px 28px 0;display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:20px}
  .modal-title{font-family:var(--font-display);font-size:18px;font-weight:700}
  .modal-close{background:none;border:none;color:var(--muted);cursor:pointer;font-size:20px}
  .modal-body{padding:0 28px 28px}
  .detail-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px}
  .detail-box{background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:14px}
  .detail-box-label{font-size:10px;letter-spacing:1.5px;text-transform:uppercase;color:var(--muted);margin-bottom:6px}
  .detail-box-val{font-family:var(--font-display);font-size:20px;font-weight:600}
  .reasoning-block{background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:16px;margin-bottom:12px}
  .reasoning-title{font-size:10px;letter-spacing:1.5px;text-transform:uppercase;color:var(--muted);margin-bottom:8px}
  .reasoning-text{font-size:12px;line-height:1.7}
  .modal-actions{display:flex;gap:8px;margin-top:16px}
  
  .two-col{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px}
  .filter-row{display:flex;gap:8px}
  .filter-btn{padding:6px 14px;border-radius:4px;border:1px solid var(--border);background:none;color:var(--muted);cursor:pointer;font-family:var(--font-mono);font-size:11px;transition:all 0.15s}
  .filter-btn.active,.filter-btn:hover{border-color:var(--accent3);color:var(--accent3);background:rgba(124,111,255,0.08)}
  .run-agent-btn{padding:8px 20px;border-radius:6px;border:1px solid rgba(0,255,136,0.3);background:rgba(0,255,136,0.1);color:var(--accent);font-family:var(--font-mono);font-size:12px;cursor:pointer;transition:all 0.15s}
  .run-agent-btn:hover{background:rgba(0,255,136,0.2)}
</style>
</head>
<body>

<!-- Auth -->
<div class="auth-overlay" id="auth-overlay">
  <div class="auth-box">
    <div class="auth-logo">STOK</div>
    <div class="auth-sub">Agentic Inventory Manager · Sign in to continue</div>
    <div class="form-group">
      <label class="form-label">Email</label>
      <input type="email" class="form-input" id="auth-email" placeholder="manager@company.com"/>
    </div>
    <div class="form-group">
      <label class="form-label">Password</label>
      <input type="password" class="form-input" id="auth-password" placeholder="••••••••" onkeydown="if(event.key==='Enter')login()"/>
    </div>
    <button class="btn-full" onclick="login()">Sign In</button>
    <div class="auth-error" id="auth-error">Invalid email or password</div>
    <div style="margin-top:12px;font-size:11px;color:var(--muted);text-align:center">
      First time? <span style="color:var(--accent3);cursor:pointer" onclick="showRegister()">Create account</span>
    </div>
  </div>
</div>

<header id="main-header" style="display:none">
  <div class="logo"><div class="logo-dot"></div>STOK</div>
  <div class="tab-bar">
    <button class="tab active" onclick="showSection('dashboard')">Dashboard</button>
    <button class="tab" onclick="showSection('actions')">Pending <span id="pending-badge" style="color:var(--danger)"></span></button>
    <button class="tab" onclick="showSection('inventory')">Inventory</button>
    <button class="tab" onclick="showSection('suppliers')">Suppliers</button>
    <button class="tab" onclick="showSection('upload')">Upload CSV</button>
    <button class="tab" onclick="showSection('audit')">Audit Log</button>
  </div>
  <div class="header-right">
    <div class="agent-status"><div class="status-dot"></div>AI Agent Active</div>
    <div class="user-badge" id="user-badge"></div>
    <button style="background:none;border:1px solid var(--border);color:var(--muted);padding:5px 12px;border-radius:4px;cursor:pointer;font-family:var(--font-mono);font-size:11px" onclick="logout()">Sign out</button>
  </div>
</header>

<div class="app" id="main-app" style="display:none">

  <!-- DASHBOARD -->
  <div class="section active" id="section-dashboard">
    <div class="stats-row" id="stats-row">
      <div class="stat-card green"><div class="stat-label">Total SKUs</div><div class="stat-value" id="s-skus">—</div><div class="stat-sub">Active products</div></div>
      <div class="stat-card red"><div class="stat-label">Stockout Risk</div><div class="stat-value" id="s-risk">—</div><div class="stat-sub"><span class="danger" id="s-critical">—</span> critical</div></div>
      <div class="stat-card orange"><div class="stat-label">Pending Actions</div><div class="stat-value" id="s-actions">—</div><div class="stat-sub">Value: <span class="hi" id="s-value">—</span></div></div>
      <div class="stat-card purple"><div class="stat-label">AI Accuracy</div><div class="stat-value" id="s-accuracy">—</div><div class="stat-sub">Forecast model</div></div>
      <div class="stat-card yellow"><div class="stat-label">Slow Movers</div><div class="stat-value" id="s-slow">—</div><div class="stat-sub"><span class="warn" id="s-slowval">—</span> at risk</div></div>
    </div>
    <div class="section-header">
      <div class="section-title">Urgent Actions <span class="badge" id="urgent-badge">Needs Review</span></div>
      <div style="display:flex;gap:8px">
        <button class="run-agent-btn" onclick="runAgent()">⚡ Run AI Agent Now</button>
        <button class="btn-detail btn" onclick="showSection('actions')">View All →</button>
      </div>
    </div>
    <div class="actions-grid" id="dashboard-actions"><div class="loading"><div class="spinner"></div><br>Loading...</div></div>
  </div>

  <!-- ACTIONS -->
  <div class="section" id="section-actions">
    <div class="section-header">
      <div class="section-title">Pending Actions <span class="badge" id="all-actions-badge"></span></div>
      <div class="filter-row">
        <button class="filter-btn active" onclick="filterActions('all',this)">All</button>
        <button class="filter-btn" onclick="filterActions('order',this)">Orders</button>
        <button class="filter-btn" onclick="filterActions('transfer',this)">Transfers</button>
        <button class="filter-btn" onclick="filterActions('price',this)">Pricing</button>
        <button class="filter-btn" onclick="filterActions('return',this)">Returns</button>
      </div>
    </div>
    <div class="actions-grid" id="all-actions"><div class="loading"><div class="spinner"></div><br>Loading...</div></div>
  </div>

  <!-- INVENTORY -->
  <div class="section" id="section-inventory">
    <div class="section-header">
      <div class="section-title">Inventory <span class="badge accent">Live</span></div>
    </div>
    <div class="table-wrap">
      <table>
        <thead><tr><th>SKU</th><th>Product</th><th>Category</th><th>Stock</th><th>Velocity</th><th>Days Left</th><th>Reorder Point</th><th>Risk</th></tr></thead>
        <tbody id="inventory-tbody"><tr><td colspan="8"><div class="loading"><div class="spinner"></div><br>Loading...</div></td></tr></tbody>
      </table>
    </div>
  </div>

  <!-- SUPPLIERS -->
  <div class="section" id="section-suppliers">
    <div class="section-header"><div class="section-title">Supplier Intelligence</div></div>
    <div class="supplier-grid" id="supplier-grid"><div class="loading"><div class="spinner"></div></div></div>
  </div>

  <!-- UPLOAD CSV -->
  <div class="section" id="section-upload">
    <div class="section-header"><div class="section-title">Upload CSV Data</div></div>
    <div class="upload-grid">
      <!-- SKUs -->
      <div class="upload-card">
        <div class="upload-title">1. Products (SKUs)</div>
        <div class="upload-desc">Upload your product catalog. Existing SKUs will be updated, new ones created.</div>
        <div class="upload-cols">
          <strong>Required:</strong> sku_code, name<br>
          <strong>Optional:</strong> category, unit_cost, unit_price, reorder_point, safety_stock, lead_time_days, moq
        </div>
        <div class="file-drop" id="drop-skus" onclick="document.getElementById('file-skus').click()" ondragover="dragOver(event,'drop-skus')" ondragleave="dragLeave('drop-skus')" ondrop="handleDrop(event,'skus')">
          <input type="file" id="file-skus" accept=".csv" onchange="handleFile(this,'skus')"/>
          <div class="file-drop-label" id="label-skus">Drop CSV here or <strong>browse</strong></div>
        </div>
        <div class="upload-result" id="result-skus"></div>
        <button class="btn-upload" style="margin-top:12px" onclick="uploadFile('skus')" id="btn-skus" disabled>Upload SKUs</button>
      </div>

      <!-- Sales -->
      <div class="upload-card">
        <div class="upload-title">2. Sales History</div>
        <div class="upload-desc">Upload historical daily sales. Used to train the demand forecast model. Upload SKUs first.</div>
        <div class="upload-cols">
          <strong>Required:</strong> sku_code, date (YYYY-MM-DD), quantity_sold<br>
          <strong>Optional:</strong> revenue, channel
        </div>
        <div class="file-drop" id="drop-sales" onclick="document.getElementById('file-sales').click()" ondragover="dragOver(event,'drop-sales')" ondragleave="dragLeave('drop-sales')" ondrop="handleDrop(event,'sales')">
          <input type="file" id="file-sales" accept=".csv" onchange="handleFile(this,'sales')"/>
          <div class="file-drop-label" id="label-sales">Drop CSV here or <strong>browse</strong></div>
        </div>
        <div class="upload-result" id="result-sales"></div>
        <button class="btn-upload" style="margin-top:12px" onclick="uploadFile('sales')" id="btn-sales" disabled>Upload Sales</button>
      </div>

      <!-- Inventory -->
      <div class="upload-card">
        <div class="upload-title">3. Current Inventory</div>
        <div class="upload-desc">Upload current stock levels. This is what the AI uses to detect stockout risk.</div>
        <div class="upload-cols">
          <strong>Required:</strong> sku_code, quantity<br>
          <strong>Optional:</strong> location
        </div>
        <div class="file-drop" id="drop-inventory" onclick="document.getElementById('file-inventory').click()" ondragover="dragOver(event,'drop-inventory')" ondragleave="dragLeave('drop-inventory')" ondrop="handleDrop(event,'inventory')">
          <input type="file" id="file-inventory" accept=".csv" onchange="handleFile(this,'inventory')"/>
          <div class="file-drop-label" id="label-inventory">Drop CSV here or <strong>browse</strong></div>
        </div>
        <div class="upload-result" id="result-inventory"></div>
        <button class="btn-upload" style="margin-top:12px" onclick="uploadFile('inventory')" id="btn-inventory" disabled>Upload Inventory</button>
      </div>

      <!-- Suppliers -->
      <div class="upload-card">
        <div class="upload-title">4. Suppliers</div>
        <div class="upload-desc">Upload supplier info. AI will rank them by performance and prefer top-ranked for orders.</div>
        <div class="upload-cols">
          <strong>Required:</strong> code, name<br>
          <strong>Optional:</strong> contact_email, avg_lead_time_days, on_time_delivery_rate, quality_rate, cost_variance_pct
        </div>
        <div class="file-drop" id="drop-suppliers" onclick="document.getElementById('file-suppliers').click()" ondragover="dragOver(event,'drop-suppliers')" ondragleave="dragLeave('drop-suppliers')" ondrop="handleDrop(event,'suppliers')">
          <input type="file" id="file-suppliers" accept=".csv" onchange="handleFile(this,'suppliers')"/>
          <div class="file-drop-label" id="label-suppliers">Drop CSV here or <strong>browse</strong></div>
        </div>
        <div class="upload-result" id="result-suppliers"></div>
        <button class="btn-upload" style="margin-top:12px" onclick="uploadFile('suppliers')" id="btn-suppliers" disabled>Upload Suppliers</button>
      </div>
    </div>

    <!-- Sample download -->
    <div style="margin-top:24px;background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:20px;">
      <div style="font-family:var(--font-display);font-size:14px;font-weight:600;margin-bottom:8px;">Sample CSV Templates</div>
      <div style="font-size:12px;color:var(--muted);margin-bottom:12px;">Download these templates, fill with your data, then upload above.</div>
      <div style="display:flex;gap:10px;flex-wrap:wrap">
        <button class="btn-detail btn" onclick="downloadSample('skus')">↓ skus_template.csv</button>
        <button class="btn-detail btn" onclick="downloadSample('sales')">↓ sales_template.csv</button>
        <button class="btn-detail btn" onclick="downloadSample('inventory')">↓ inventory_template.csv</button>
        <button class="btn-detail btn" onclick="downloadSample('suppliers')">↓ suppliers_template.csv</button>
      </div>
    </div>
  </div>

  <!-- AUDIT -->
  <div class="section" id="section-audit">
    <div class="section-header"><div class="section-title">Audit Trail</div></div>
    <div class="audit-list">
      <div class="audit-item" style="background:var(--surface2)">
        <div style="font-size:10px;letter-spacing:1px;color:var(--muted)">TIMESTAMP</div>
        <div style="font-size:10px;letter-spacing:1px;color:var(--muted)">USER</div>
        <div style="font-size:10px;letter-spacing:1px;color:var(--muted)">EVENT</div>
        <div style="font-size:10px;letter-spacing:1px;color:var(--muted)">DETAIL</div>
        <div style="font-size:10px;letter-spacing:1px;color:var(--muted)">OUTCOME</div>
      </div>
      <div id="audit-body"><div class="loading"><div class="spinner"></div></div></div>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal-overlay" id="modal-overlay" onclick="if(event.target===this)closeModal()">
  <div class="modal">
    <div class="modal-header">
      <div><div class="modal-title" id="modal-title"></div><div style="font-size:11px;color:var(--muted);margin-top:4px" id="modal-sub"></div></div>
      <button class="modal-close" onclick="closeModal()">✕</button>
    </div>
    <div class="modal-body" id="modal-body"></div>
  </div>
</div>

<div class="toast-container" id="toast-container"></div>

<script>
const API = window.location.origin; // auto-detects server URL
let token = localStorage.getItem('stok_token');
let currentUser = JSON.parse(localStorage.getItem('stok_user') || 'null');
let allActions = [];
let fileCache = {};

// ── AUTH ────────────────────────────────────────────────────────
async function login() {
  const email = document.getElementById('auth-email').value;
  const password = document.getElementById('auth-password').value;
  try {
    const res = await fetch(`${API}/auth/login`, {
      method: 'POST', headers: {'Content-Type':'application/json'},
      body: JSON.stringify({email, password})
    });
    if (!res.ok) { document.getElementById('auth-error').style.display = 'block'; return; }
    const data = await res.json();
    token = data.access_token;
    currentUser = {name: data.user_name, email: data.user_email};
    localStorage.setItem('stok_token', token);
    localStorage.setItem('stok_user', JSON.stringify(currentUser));
    showApp();
  } catch(e) {
    document.getElementById('auth-error').textContent = 'Cannot connect to server. Is backend running?';
    document.getElementById('auth-error').style.display = 'block';
  }
}

function showRegister() {
  const email = prompt('Email:');
  const password = prompt('Password:');
  const name = prompt('Your name:');
  if (!email || !password) return;
  fetch(`${API}/auth/register?name=${encodeURIComponent(name||'Manager')}`, {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({email, password})
  }).then(r => r.json()).then(d => { toast(d.message || 'Account created. Sign in now.', 'success'); });
}

function logout() {
  localStorage.removeItem('stok_token');
  localStorage.removeItem('stok_user');
  location.reload();
}

function showApp() {
  document.getElementById('auth-overlay').style.display = 'none';
  document.getElementById('main-header').style.display = 'flex';
  document.getElementById('main-app').style.display = 'block';
  document.getElementById('user-badge').textContent = currentUser?.email || '';
  loadDashboard();
}

// ── API CALLS ────────────────────────────────────────────────────
async function api(path, options = {}) {
  const res = await fetch(`${API}${path}`, {
    ...options,
    headers: { 'Authorization': `Bearer ${token}`, ...(options.headers || {}) }
  });
  if (res.status === 401) { logout(); return null; }
  return res;
}

async function loadDashboard() {
  try {
    const [statsRes, actionsRes] = await Promise.all([
      api('/stats/dashboard'),
      api('/actions/?status=pending')
    ]);
    if (!statsRes || !actionsRes) return;
    const stats = await statsRes.json();
    const actions = await actionsRes.json();
    allActions = actions;
    renderStats(stats);
    renderUrgentActions(actions);
    updatePendingBadge(actions.length);
  } catch(e) { toast('Failed to load dashboard', 'error'); }
}

async function loadActions() {
  try {
    const res = await api('/actions/');
    if (!res) return;
    allActions = await res.json();
    renderAllActions(allActions);
    updatePendingBadge(allActions.filter(a=>a.status==='pending').length);
  } catch(e) { toast('Failed to load actions', 'error'); }
}

async function loadInventory() {
  try {
    const res = await api('/inventory/');
    if (!res) return;
    const data = await res.json();
    renderInventory(data);
  } catch(e) { toast('Failed to load inventory', 'error'); }
}

async function loadSuppliers() {
  try {
    const res = await api('/suppliers/');
    if (!res) return;
    const data = await res.json();
    renderSuppliers(data);
  } catch(e) { toast('Failed to load suppliers', 'error'); }
}

async function loadAudit() {
  try {
    const res = await api('/audit/');
    if (!res) return;
    const data = await res.json();
    renderAudit(data);
  } catch(e) { toast('Failed to load audit log', 'error'); }
}

async function approveAction(id) {
  const qtyInput = document.getElementById(`qty-${id}`);
  const qty = qtyInput ? parseInt(qtyInput.value) : null;
  try {
    const res = await api(`/actions/${id}/approve`, {
      method: 'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({quantity_override: qty})
    });
    if (!res) return;
    const data = await res.json();
    toast(`${data.outcome === 'modified' ? 'Modified &' : ''} Approved`, 'success');
    refreshCurrentSection();
  } catch(e) { toast('Failed to approve', 'error'); }
}

async function rejectAction(id) {
  const reason = prompt('Reason for rejection (optional):') || '';
  try {
    const res = await api(`/actions/${id}/reject`, {
      method: 'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({reason})
    });
    if (!res) return;
    toast('Action rejected', 'info');
    refreshCurrentSection();
  } catch(e) { toast('Failed to reject', 'error'); }
}

async function runAgent() {
  toast('Running AI agent scan...', 'info');
  try {
    const res = await api('/agent/run', { method: 'POST' });
    if (!res) return;
    const data = await res.json();
    toast(data.message, 'success');
    refreshCurrentSection();
  } catch(e) { toast('Agent run failed', 'error'); }
}

// ── RENDER ────────────────────────────────────────────────────────
function renderStats(s) {
  document.getElementById('s-skus').textContent = s.total_skus;
  document.getElementById('s-risk').textContent = s.stockout_risk_count;
  document.getElementById('s-critical').textContent = s.critical_count;
  document.getElementById('s-actions').textContent = s.pending_actions_count;
  document.getElementById('s-value').textContent = `$${Math.round(s.pending_value).toLocaleString()}`;
  document.getElementById('s-accuracy').textContent = s.ai_accuracy ? `${s.ai_accuracy}%` : 'N/A';
  document.getElementById('s-slow').textContent = s.slow_movers_count;
  document.getElementById('s-slowval').textContent = `$${Math.round(s.slow_movers_value).toLocaleString()}`;
}

function actionCardHTML(a, compact = false) {
  const typeClass = {order:'type-order',transfer:'type-transfer',price:'type-price',return:'type-return',disposal:'type-disposal'};
  const typeLabel = {order:'ORDER',transfer:'TRANSFER',price:'PRICE',return:'RETURN',disposal:'DISPOSAL'};
  const valueStr = a.type === 'price' ? `${a.recommended_value}% change`
    : a.recommended_value ? `$${Math.round(a.recommended_value).toLocaleString()}` : '—';

  const statusHTML = a.status !== 'pending'
    ? `<span class="status-tag tag-${a.status}">${a.status==='approved'?'✓ Approved':'✕ Rejected'}</span>`
    : `<div class="btn-row">
        <button class="btn btn-detail" onclick="openDetail('${a.id}')">Detail</button>
        <button class="btn btn-reject" onclick="rejectAction('${a.id}')">Reject</button>
        <button class="btn btn-approve" onclick="approveAction('${a.id}')">Approve ✓</button>
       </div>`;

  const qtyRow = a.recommended_qty && a.status === 'pending'
    ? `<div class="qty-modify">Qty: <input class="qty-input" type="number" value="${a.recommended_qty}" id="qty-${a.id}"/> units</div>` : '';

  return `<div class="action-card ${a.priority}" id="card-${a.id}" data-type="${a.type}">
    <div><span class="action-type-badge ${typeClass[a.type]||'type-order'}">${typeLabel[a.type]||a.type.toUpperCase()}</span></div>
    <div>
      <div class="action-title">${a.title}</div>
      <div class="action-meta">
        <span>SKU: <em>${a.sku_code||'—'}</em></span>
        <span>Value: <em>${valueStr}</em></span>
        ${a.supplier_name ? `<span>Supplier: <em>${a.supplier_name}</em></span>` : ''}
        <span>Priority: <em style="color:${a.priority==='urgent'?'var(--danger)':a.priority==='high'?'var(--warn)':'var(--accent3)'}">${a.priority.toUpperCase()}</em></span>
      </div>
      ${!compact && a.justification ? `<div class="action-reasoning">${a.justification}</div>` : ''}
      ${a.confidence_score ? `<div class="confidence-bar">
        <span>Confidence</span>
        <div class="bar-track"><div class="bar-fill" style="width:${a.confidence_score}%;background:${a.confidence_score>90?'var(--accent)':a.confidence_score>75?'var(--warn)':'var(--accent2)'}"></div></div>
        <span style="color:${a.confidence_score>90?'var(--accent)':a.confidence_score>75?'var(--warn)':'var(--accent2)'}">${a.confidence_score}%</span>
      </div>` : ''}
    </div>
    <div class="action-controls">${qtyRow}${statusHTML}</div>
  </div>`;
}

function renderUrgentActions(actions) {
  const urgent = actions.filter(a => (a.priority==='urgent'||a.priority==='high') && a.status==='pending').slice(0,4);
  const el = document.getElementById('dashboard-actions');
  el.innerHTML = urgent.length ? urgent.map(a=>actionCardHTML(a,true)).join('') 
    : '<div style="padding:32px;text-align:center;color:var(--muted);font-size:12px">No urgent actions — all good!</div>';
  const badge = document.getElementById('urgent-badge');
  badge.textContent = urgent.length ? `${urgent.length} need review` : 'All clear';
}

function renderAllActions(actions) {
  const el = document.getElementById('all-actions');
  const pending = actions.filter(a=>a.status==='pending');
  document.getElementById('all-actions-badge').textContent = `${pending.length} pending`;
  el.innerHTML = actions.length ? actions.map(a=>actionCardHTML(a,false)).join('')
    : '<div style="padding:40px;text-align:center;color:var(--muted)">No actions yet — upload data and run the AI agent</div>';
}

function filterActions(type, btn) {
  document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  document.querySelectorAll('[data-type]').forEach(card => {
    card.style.display = (type==='all' || card.dataset.type===type) ? '' : 'none';
  });
}

function renderInventory(skus) {
  const tb = document.getElementById('inventory-tbody');
  if (!skus.length) { tb.innerHTML = '<tr><td colspan="8" style="text-align:center;padding:40px;color:var(--muted)">No inventory data — upload inventory.csv</td></tr>'; return; }
  const riskColor = {critical:'var(--danger)',high:'var(--warn)',medium:'var(--accent2)',low:'var(--accent)'};
  tb.innerHTML = skus.map(sku => {
    const pct = Math.min(100, (sku.current_stock / ((sku.reorder_point||20) * 4)) * 100);
    const fill = riskColor[sku.risk_level];
    return `<tr>
      <td style="color:var(--accent3);font-weight:500">${sku.sku_code}</td>
      <td>${sku.name}</td>
      <td style="color:var(--muted)">${sku.category||'—'}</td>
      <td><div class="stock-bar-wrap">${sku.current_stock}<div class="stock-mini-bar"><div class="stock-mini-fill" style="width:${pct}%;background:${fill}"></div></div></div></td>
      <td>${sku.daily_velocity}/day</td>
      <td style="color:${sku.days_remaining && sku.days_remaining<7?'var(--danger)':sku.days_remaining&&sku.days_remaining<20?'var(--warn)':'var(--accent)'};font-weight:500">${sku.days_remaining!=null?sku.days_remaining+'d':'∞'}</td>
      <td style="color:var(--muted)">${sku.reorder_point}</td>
      <td><span class="risk-badge risk-${sku.risk_level}">${sku.risk_level}</span></td>
    </tr>`;
  }).join('');
}

function renderSuppliers(suppliers) {
  const el = document.getElementById('supplier-grid');
  if (!suppliers.length) { el.innerHTML = '<div style="color:var(--muted);font-size:12px">No suppliers — upload suppliers.csv</div>'; return; }
  const colors = ['var(--accent)','var(--accent3)','var(--warn)','var(--accent2)','var(--muted)'];
  el.innerHTML = suppliers.map((s,i) => `
    <div class="supplier-card">
      <div class="supplier-header">
        <div><div class="supplier-name">${s.name}</div><div class="supplier-code">${s.code}</div></div>
        <div class="supplier-rank" style="color:${colors[i]||'var(--muted)'}">#${s.ai_rank||i+1}</div>
      </div>
      <div class="metric-row"><span class="metric-label">On-Time Delivery</span><span style="color:${(s.on_time_delivery_rate||0)>90?'var(--accent)':'var(--warn)'}">${s.on_time_delivery_rate!=null?s.on_time_delivery_rate+'%':'—'}</span></div>
      <div class="metric-row"><span class="metric-label">Quality Rate</span><span>${s.quality_rate!=null?s.quality_rate+'%':'—'}</span></div>
      <div class="metric-row"><span class="metric-label">Avg Lead Time</span><span>${s.avg_lead_time_days!=null?s.avg_lead_time_days+'d':'—'}</span></div>
      <div class="metric-row"><span class="metric-label">Cost Variance</span><span style="color:${(s.cost_variance_pct||0)<0?'var(--accent)':'var(--accent2)'}">${s.cost_variance_pct!=null?(s.cost_variance_pct>0?'+':'')+s.cost_variance_pct+'%':'—'}</span></div>
    </div>`).join('');
}

function renderAudit(logs) {
  const el = document.getElementById('audit-body');
  if (!logs.length) { el.innerHTML = '<div style="padding:40px;text-align:center;color:var(--muted)">No audit entries yet</div>'; return; }
  const oc = {approved:'outcome-approved',rejected:'outcome-rejected',modified:'outcome-modified',executed:'outcome-executed'};
  el.innerHTML = logs.map(e => `
    <div class="audit-item">
      <div class="audit-time">${new Date(e.timestamp).toLocaleString()}</div>
      <div style="color:var(--accent3)">${e.user_email||'System'}</div>
      <div>${e.event_type}</div>
      <div style="color:var(--muted)">${e.detail||'—'}</div>
      <div class="${oc[e.outcome]||''}">${e.outcome?.toUpperCase()||'—'}</div>
    </div>`).join('');
}

function openDetail(id) {
  const a = allActions.find(x=>x.id===id);
  if (!a) return;
  document.getElementById('modal-title').textContent = a.title;
  document.getElementById('modal-sub').textContent = `${a.sku_code} · ${a.sku_name}`;
  const val = a.type==='price'?`${a.recommended_value}%`:a.recommended_value?`$${Math.round(a.recommended_value).toLocaleString()}`:'—';
  document.getElementById('modal-body').innerHTML = `
    <div class="detail-grid">
      <div class="detail-box"><div class="detail-box-label">Type</div><div class="detail-box-val" style="font-size:16px">${a.type.toUpperCase()}</div></div>
      <div class="detail-box"><div class="detail-box-label">Value</div><div class="detail-box-val">${val}</div></div>
      <div class="detail-box"><div class="detail-box-label">Confidence</div><div class="detail-box-val" style="color:${(a.confidence_score||0)>90?'var(--accent)':'var(--warn)'}">${a.confidence_score||'—'}%</div></div>
      <div class="detail-box"><div class="detail-box-label">Quantity</div><div class="detail-box-val">${a.recommended_qty?a.recommended_qty+' units':'—'}</div></div>
    </div>
    ${a.justification?`<div class="reasoning-block"><div class="reasoning-title">AI Justification</div><div class="reasoning-text">${a.justification}</div></div>`:''}
    ${a.risks?`<div class="reasoning-block"><div class="reasoning-title">Risk of Inaction</div><div class="reasoning-text">${a.risks}</div></div>`:''}
    ${a.alternatives?`<div class="reasoning-block"><div class="reasoning-title">Alternatives</div><div class="reasoning-text">${a.alternatives}</div></div>`:''}
    ${a.status==='pending'?`<div class="modal-actions">
      <button class="btn btn-reject" onclick="rejectAction('${a.id}');closeModal()">Reject</button>
      <button class="btn btn-approve" onclick="approveAction('${a.id}');closeModal()">Approve ✓</button>
    </div>`:''}`;
  document.getElementById('modal-overlay').classList.add('open');
}

function closeModal() { document.getElementById('modal-overlay').classList.remove('open'); }

// ── CSV UPLOAD ────────────────────────────────────────────────────
function handleFile(input, type) {
  const file = input.files[0];
  if (!file) return;
  fileCache[type] = file;
  document.getElementById(`label-${type}`).textContent = `✓ ${file.name}`;
  document.getElementById(`btn-${type}`).disabled = false;
}

function dragOver(e, id) { e.preventDefault(); document.getElementById(id).classList.add('dragover'); }
function dragLeave(id) { document.getElementById(id).classList.remove('dragover'); }
function handleDrop(e, type) {
  e.preventDefault();
  dragLeave(`drop-${type}`);
  const file = e.dataTransfer.files[0];
  if (file && file.name.endsWith('.csv')) {
    fileCache[type] = file;
    document.getElementById(`label-${type}`).textContent = `✓ ${file.name}`;
    document.getElementById(`btn-${type}`).disabled = false;
  }
}

async function uploadFile(type) {
  const file = fileCache[type];
  if (!file) return;
  const btn = document.getElementById(`btn-${type}`);
  const result = document.getElementById(`result-${type}`);
  btn.disabled = true;
  btn.textContent = 'Uploading...';
  result.style.display = 'none';

  const form = new FormData();
  form.append('file', file);
  try {
    const res = await api(`/upload/${type}`, { method:'POST', body:form });
    if (!res) return;
    const data = await res.json();
    result.style.display = 'block';
    if (res.ok) {
      result.className = 'upload-result success';
      result.innerHTML = `✓ ${data.message}` + (data.errors?.length ? `<br><br>Errors (${data.rows_failed}):<br>${data.errors.slice(0,5).map(e=>`• ${e}`).join('<br>')}` : '');
      toast(`${type} uploaded successfully`, 'success');
    } else {
      result.className = 'upload-result error';
      result.textContent = data.detail || 'Upload failed';
    }
  } catch(e) {
    result.className = 'upload-result error';
    result.style.display = 'block';
    result.textContent = 'Upload failed — is backend running?';
  }
  btn.textContent = `Upload ${type.charAt(0).toUpperCase()+type.slice(1)}`;
  btn.disabled = false;
}

function downloadSample(type) {
  const templates = {
    skus: 'sku_code,name,category,unit_cost,unit_price,reorder_point,safety_stock,lead_time_days,moq\nSKU-001,Product Name,Category,10.00,25.99,20,10,7,10',
    sales: 'sku_code,date,quantity_sold,revenue,channel\nSKU-001,2024-01-01,5,129.95,online',
    inventory: 'sku_code,quantity,location\nSKU-001,150,Warehouse A',
    suppliers: 'code,name,contact_email,avg_lead_time_days,on_time_delivery_rate,quality_rate,cost_variance_pct\nSUP-001,Supplier Name,orders@supplier.com,7,90,98,1.5'
  };
  const blob = new Blob([templates[type]], {type:'text/csv'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `${type}_template.csv`;
  a.click();
}

// ── NAVIGATION ────────────────────────────────────────────────────
let currentSection = 'dashboard';
function showSection(name) {
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.getElementById(`section-${name}`).classList.add('active');
  const sectionNames = ['dashboard','actions','inventory','suppliers','upload','audit'];
  document.querySelectorAll('.tab')[sectionNames.indexOf(name)]?.classList.add('active');
  currentSection = name;
  if (name==='actions') loadActions();
  else if (name==='inventory') loadInventory();
  else if (name==='suppliers') loadSuppliers();
  else if (name==='audit') loadAudit();
}

function refreshCurrentSection() {
  if (currentSection==='dashboard') loadDashboard();
  else if (currentSection==='actions') loadActions();
  else if (currentSection==='audit') loadAudit();
}

function updatePendingBadge(n) {
  document.getElementById('pending-badge').textContent = n > 0 ? `(${n})` : '';
}

function toast(msg, type='info') {
  const icons = {success:'✓',error:'✕',info:'→'};
  const el = document.createElement('div');
  el.className = `toast ${type}`;
  el.innerHTML = `<span>${icons[type]}</span><span>${msg}</span>`;
  document.getElementById('toast-container').appendChild(el);
  setTimeout(()=>el.remove(), 3500);
}

// ── INIT ──────────────────────────────────────────────────────────
if (token && currentUser) showApp();
</script>
</body>
</html>
